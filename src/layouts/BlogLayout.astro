---
import TOC from "@components/TOC.astro";
import '../styles/global.css';

export interface Props {
  content: {
    title: string;
  };
  headings: {
    slug: string;
    text: string;
    depth: number;
  }[];
}

const {
  content:
  
  { title },
  headings,
} = Astro.props;
---

<html>
  <body>
    <article>
      {
        headings && headings.length > 0 && (
          <div class="absolute right-[-270px] h-full">
            <nav class="sticky top-8 w-[200px]">
            <h3>Table of Content</h3>
            <TOC headings={headings} />
          </nav>
          </div>
          
        )
      }

      <div class="article-content">
        <slot />
      </div>
    </article>
  </body>
</html>


<script>
  addIntersectionObserver();

function addIntersectionObserver()
{
  const observer = new IntersectionObserver((sections) => {
    sections.forEach((section) => {
      const heading = section.target.querySelector('h2, h3, h4, h5');
      if (!heading) return;
      const id = heading.getAttribute('id');

      // Get the link to this section's heading
      const link = document.querySelector(`nav.article-toc li a[href="#${id}"]`);
      if (!link) return;

      // Add/remove the .active class based on whether the
      // section is visible
      const addRemove = section.intersectionRatio > 0 ? 'add' : 'remove';
      link.classList[addRemove]('active');
    });
  });

  document.querySelectorAll('.article-content section').forEach((section) => {
    observer.observe(section);
  })
}

</script>